# 信号（一）

## 中断

中断是系统对于异步事件的响应

### 中断分类
- 硬件中断(外部中断)：外部中断是指由外部设备通过硬件请求的方式产生的中断，也称为硬件中断
- 软件中断（内部中断)：内部中断是由CPU运行程序错误或执行内部程序调用引起的一种中断，也称为软件中断。

## 信号
- 信号是UNIX系统响应某些状况而产生的事件，进程在接收到信号时会采取相应的行动。
- 信号是因为某些错误条件而产生的，比如内存段冲突、浮点处理器错误或者非法指令等。
- 信号是在软件层次上对中断的一种模拟，所以通常把它称为是软中断。
- kill -l命令查看信号名称，man 7 signal查看详细手册
- 信号的名称是在头文件signal.h里定义的
### 常用的信号
信号名称|描述
-|-
SIGABRT|进程停止运行
SIGALRM|警告钟
SIGFPE|算述运算例外
SIGHUP|系统桂断
SIGILL|非法指令
SIGINT|终端中断
SIGKI LL|停止进程（此信号不能被忽略或捕获)
SIGPIPE|向没有读者的管道写入数据
SIGSEGV|无效内存段访问


## 信号与中断

### 信号与中断的相似点:
- 采用了相同的异步通信方式;
- 当检测出有信号或中断请求时，都暂停正在执行的程序而转去执行相应的处理程序;
- 都在处理完毕后返回到原来的断点;
- 对信号或中断都可进行屏蔽。
### 信号与中断的区别:
- 中断有优先级，而信号没有优先级，所有的信号都是平等的;
- 信号处理程序是在用户态下运行的，而中断处理程序是在核心态下运行;
- 中断响应是及时的，而信号响应通常都有较大的时间延迟

## 进程对信号的反应

- 忽略信号
  - 不采取任何操作、有两个信号不能被忽略:SIGKILL和SIGSTOP。
- 捕获并处理信号
  - 内核中断正在执行的代码，转去执行先前注册过的处
- 执行默认操作
  - 默认操作通常是终止进程，这取决于被发送的信号。


## signal
功能：给程序安装一个信号处理程序
```
typedef void (*_sighandler_t)(int);
#define SlG_ERR((_sighandler_t) -1)
#define SlG_DFL ((__sighandler_t )0)
#define slG_IGN((__sighandler_t)1)
```
- 函数原型:
  - _sighandler_t signal(int signum,__sighandler_t handler);
- 参数
  - signal是一个带signum和handler两个参数的函数，准备捕捉或屏蔽的信号由参数signum给出，接收到指定信号时将要调用的函数由handler给出
  - handler这个函数必须有一个int类型的参数（即接收到的信号代码)，它本身的类型是void
  - handler也可以是下面两个特殊值:SIG_IGN 屏蔽该信号; SIG_DFL恢复默认行为

# 信号（二）

## 信号分类
- 可靠信号
- 不可靠信号
- 实时信号
- 非实时信号

## 不可靠信号
linux信号机制基本上是从unix系统中继承过来的。早期unix系统中的信号机制比较简单和原始，后来在实践中暴露出一些问题，它的主要问题是:
- 进程每次处理信号后，就将对信号的响应设置为默认动作。在某些情况下，将导致对信号的错误处理;因此，用户如果不希望这样的操作，那么就要在信号处理函数结尾再一次调用signal()，重新安装该信号。
- 早期unix下的不可靠信号主要指的是进程可能对信号做出错误的反应以及信号可能丢失。
- linux支持不可靠信号，但是对不可靠信号机制做了改进:在调用完信号处理函数后，不必重新调用该信号的安装函数（信号安装函数是在可靠机制上的实现)。因此，linux下的不可靠信号问题主要指的是信号可能丢失。
- 从SIGHUP ~ SIGSYS均为不可靠信号

## 可靠信号（又称实时信号）
- 随着时间的发展，实践证明了有必要对信号的原始机制加以改进和扩充。所以，后来出现的各种uni版本分别在这方面进行了研究，力图实现"可靠信号"。由于原来定义的信号已有许多应用，不好再做改动，最终只好又新增加了一些信号，并在一开始就把它们定义为可靠信号，这些信号支持排队，不会丢失。
- 同时，信号的发送和安装也出现了新版本:信号发送函数sigqueue()及信号安装函数sigaction()。
- 从SIGMIN ~ SIGMAX均为可靠信号，又称实时信号
- 早期Unix系统只定义了32种信号，Ret hat7.2支持64种信号，编号0-63(SIGRTMIN=31， SIGRTMAX=63)， 将来可能进一步增加，这需要得到内核的支持。前32种信号已经有了预定义值，每个信号有了确定的用途及含义，并且每种信号都有各自的缺省动作。如按键盘的CTRL ^C时，会产SIGINT信号，对该信号的默认反应就是进程终止。后32个信号表示实时信号，等同于前面阐述的可靠信号。这保证了发送的多个实时信号都被接收。实时信号是POSIX标准的一-部分，可用于应用进程。
- 非实时信号都不支持排队，都是不可靠信号;实时信号都支持排队，都是可靠信号。

## 信号发送
- kill
- raise 
  - 给自己发送信号。raise(sig)等价于kill (getpid(), sig);
- killpg
  - 给进程组发送信号。killpg (pgrp，sig) 等价于kill(-PgIP, sig);
- sigqueue
  - 给进程发送信号，支持排队，可以附带信息。


## pause
- 将进程置为可中断睡眠状态。然后它调用schedule()， 使linux进程调度器找到另一个进程来运行。
- pause使调用者进程挂起，直到一个信号被捕获
